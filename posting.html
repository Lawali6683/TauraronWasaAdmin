<!DOCTYPE html>
<html lang="ha">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TauraronWasa - Agents</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    <link rel="stylesheet" href="agents.css">
    <style>      
       
:root {
    --primary: #a05aff;
    --secondary: #300040;
    --success: #17c671;
    --error: #f44336;
    --white: #fff;
    --gray: #b2b0c6;
    --shadow: 0 2px 14px 0 rgba(90, 76, 151, 0.14);
    --dark-bg-gradient: linear-gradient(to bottom, #180022, #300040);
    --card-bg: rgba(28, 0, 44, 0.98);
    --input-bg: #210931;
    --input-border: #4a3568;
    --news-card-bg: rgba(34, 1, 46, 0.96);
    --new-post-section-bg: rgba(39, 2, 54, 0.93);
    --approved-card-bg: rgba(31, 0, 33, 0.97);
    --button-hover-dark: #7b3ced;
}

/* Base Styles */
body {
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
    background: var(--dark-bg-gradient);
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-size: cover;
    color: var(--white);
    min-height: 100vh;
    line-height: 1.6;
}

/* Preloader */
#preloader {
    position: fixed;
    inset: 0;
    background: rgba(21, 0, 33, 0.96);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.5s ease-out;
}

.loader {
    border: 8px solid var(--gray);
    border-top: 8px solid var(--primary);
    border-radius: 50%;
    width: 56px;
    height: 56px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    100% {
        transform: rotate(360deg);
    }
}

/* Centered Section (Login) */
.centered-section {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    align-items: center;
    justify-content: center;
    padding: 1rem; /* Added padding for smaller screens */
}

.form-card {
    background: var(--card-bg);
    padding: 2rem;
    border-radius: 18px;
    box-shadow: var(--shadow);
    width: 100%;
    max-width: 380px; /* Slightly increased max-width for better look */
    border: 1px solid rgba(160, 90, 255, 0.3); /* Soft border */
    box-sizing: border-box; /* Ensures padding doesn't increase total width */
}

.form-card h2 {
    text-align: center;
    margin-bottom: 1.5rem; /* Increased margin */
    color: var(--primary);
    font-size: 1.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.8rem;
}

/* Form Elements */
.form-group {
    margin-bottom: 1.2rem;
    display: flex;
    flex-direction: column;
    gap: 0.4rem; /* Adjusted gap */
}

.form-group label {
    font-weight: 500;
    color: var(--gray);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95em;
}

.form-group input,
.form-group textarea {
    padding: 0.9em; /* Increased padding */
    border-radius: 10px; /* More rounded borders */
    border: 1px solid var(--input-border);
    background: var(--input-bg);
    color: var(--white);
    font-size: 1em;
    resize: vertical; /* Allow vertical resize for textarea */
    outline: none;
    transition: border 0.3s ease, box-shadow 0.3s ease;
}

.form-group input:focus,
.form-group textarea:focus {
    border: 2px solid var(--primary);
    box-shadow: 0 0 0 3px rgba(160, 90, 255, 0.2); /* Soft glow on focus */
}

/* Full width textarea for posts */
.full-width-textarea {
    width: 100%;
    box-sizing: border-box; /* Include padding in width calculation */
}

/* Buttons */
.main-btn {
    width: 100%;
    padding: 0.9em; /* Increased padding */
    border: none;
    border-radius: 10px; /* More rounded borders */
    background: var(--primary);
    color: var(--white);
    font-size: 1.1em;
    cursor: pointer;
    font-weight: 600;
    box-shadow: var(--shadow);
    transition: background 0.3s ease, transform 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.7rem;
}

.main-btn:hover {
    background: var(--button-hover-dark);
    transform: translateY(-2px); /* Slight lift on hover */
}

.logout-btn {
    background: var(--error);
    border: none;
    border-radius: 8px;
    padding: 0.7em 1.2em; /* Adjusted padding */
    color: var(--white);
    font-weight: 500;
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: background 0.3s ease, transform 0.2s ease;
    display: inline-flex; /* For icon alignment */
    align-items: center;
    gap: 0.5rem;
}

.logout-btn:hover {
    background: #c73c3c; /* Slightly darker red */
    transform: translateY(-2px);
}

/* Dashboard Header */
header {
    padding: 1.5rem 1rem 1.2rem 1rem; /* Adjusted padding */
    text-align: center;
    background: rgba(36, 0, 52, 0.95); /* Slightly less transparent */
    margin-bottom: 2rem; /* Increased margin */
    border-radius: 0 0 25px 25px; /* More rounded corners */
    box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.2); /* Stronger shadow */
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap; /* Allows wrapping on smaller screens */
    gap: 1rem;
}

header h1 {
    font-size: 1.8rem; /* Larger font size */
    font-weight: 700; /* Bolder */
    color: var(--primary);
    margin: 0; /* Remove default margin */
    flex-grow: 1; /* Allows it to take available space */
    text-align: left;
}

header #user-fullname {
    font-size: 1.5rem;
    color: var(--white);
}

/* Main Content Area */
main {
    padding: 0 1.5rem; /* Padding for main content */
    max-width: 1200px;
    margin: 0 auto;
}

.actions {
    text-align: center;
    margin-bottom: 2.5rem; /* Increased margin */
}

/* News List Section */
#news-list-section,
#approved-posts {
    display: grid; /* Changed to grid for better layout control */
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid */
    gap: 1.8rem; /* Increased gap */
    justify-content: center;
    margin-bottom: 2rem;
    min-height: 80px;
    transition: min-height 0.3s;
}

.news-card,
.approved-card {
    background: var(--news-card-bg); /* Unified background variable */
    border-radius: 18px; /* More rounded corners */
    box-shadow: var(--shadow);
    padding: 1.5rem; /* Increased padding */
    display: flex;
    flex-direction: column;
    gap: 0.8rem; /* Adjusted gap */
    opacity: 0;
    transform: translateY(30px); /* Slightly less aggressive animation */
    transition: opacity 0.6s ease-out, transform 0.6s ease-out; /* Smoother transition */
    border: 1px solid rgba(160, 90, 255, 0.2); /* Subtle border */
    box-sizing: border-box;
}

.news-card.visible,
.approved-card.visible {
    opacity: 1;
    transform: translateY(0);
}

.news-card .news-title,
.approved-card .post-title {
    font-size: 1.25em; /* Larger title font */
    font-weight: 700; /* Bolder */
    color: var(--primary);
    margin-bottom: 0.5em;
    line-height: 1.3;
}

.news-card .news-meta,
.approved-card .post-meta {
    font-size: 0.9em; /* Slightly smaller meta font */
    color: var(--gray);
    margin-bottom: 0.5em;
    display: flex;
    align-items: center;
    gap: 0.6rem;
}

.news-card .news-img,
.approved-card .post-img,
.approved-card .post-video,
.approved-card .post-audio { /* Added audio style */
    width: 100%;
    border-radius: 12px; /* More rounded image borders */
    margin-bottom: 0.8em;
    max-height: 200px; /* Increased max height for images/videos */
    object-fit: cover;
    background: #1a0027;
    border: 1px solid var(--primary); /* Blue border for media */
}

.news-card .news-content,
.approved-card .post-content {
    font-size: 1.05em; /* Slightly larger content font */
    color: var(--white);
    margin-bottom: 1em; /* Increased margin */
    white-space: pre-wrap; /* Preserves whitespace and line breaks for editable content */
    word-wrap: break-word; /* Breaks long words */
    padding: 0.5rem; /* Padding for editable area */
    border-radius: 8px;
    transition: background 0.3s ease, border 0.3s ease;
}

.news-card .news-content[contenteditable="true"],
.approved-card .post-content[contenteditable="true"] {
    background-color: rgba(255, 255, 255, 0.08); /* Slightly visible background when editable */
    border: 1px dashed var(--primary); /* Dashed border to indicate editable */
    padding: 0.8rem;
}

.news-card .news-actions,
.approved-card .edit-actions {
    display: flex;
    flex-wrap: wrap; /* Allows buttons to wrap */
    justify-content: flex-end; /* Align to the right */
    align-items: center;
    margin-top: 1rem;
    gap: 0.8rem; /* Adjusted gap */
}

.news-card .news-actions button,
.approved-card .edit-actions button {
    flex: 1 1 auto; /* Allow buttons to grow/shrink */
    min-width: 90px; /* Ensure minimum width */
    background: rgba(44, 3, 59, 0.8); /* Slightly transparent background */
    border: none;
    color: #fff;
    padding: 0.7em 1em; /* Adjusted padding */
    border-radius: 10px; /* More rounded borders */
    font-size: 0.95em;
    cursor: pointer;
    transition: background 0.25s ease, transform 0.15s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.news-card .news-actions button:hover,
.approved-card .edit-actions button:hover {
    background: var(--primary);
    transform: translateY(-1px);
}

/* New Post Section */
#new-post-section {
    background: var(--new-post-section-bg);
    border-radius: 18px;
    box-shadow: var(--shadow);
    padding: 2rem; /* Increased padding */
    margin: 2.5rem auto; /* Adjusted margin */
    max-width: 500px; /* Increased max-width for the form */
    border: 1px solid rgba(160, 90, 255, 0.3);
    box-sizing: border-box;
}

#new-post-section h2 {
    color: var(--primary);
    text-align: center;
    margin-bottom: 1.8rem; /* Increased margin */
    font-size: 2rem;
}

/* Media Upload Group (New styles for icons) */
.media-upload-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 1.2rem;
}

.file-input-hidden {
    display: none; /* Hide the default file input */
}

.upload-icon-label {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background-color: var(--primary);
    color: var(--white);
    padding: 0.8em 1.2em;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1.2em;
    transition: background-color 0.3s ease, transform 0.2s ease;
    width: fit-content; /* Make label fit content */
    margin-top: 0.5rem; /* Space below label text */
}

.upload-icon-label:hover {
    background-color: var(--button-hover-dark);
    transform: translateY(-2px);
}

.upload-icon-label i {
    margin-right: 0.5rem;
}

.preview-container {
    margin-top: 0.8em; /* Adjusted margin */
    display: flex;
    flex-wrap: wrap; /* Allow previews to wrap */
    gap: 1em; /* Increased gap */
    align-items: center;
    border: 1px dashed rgba(160, 90, 255, 0.3); /* Dashed border for preview area */
    padding: 0.8em;
    border-radius: 10px;
    background: rgba(0,0,0,0.1);
}

.preview-container img,
.preview-container video {
    border-radius: 10px; /* Slightly more rounded */
    max-width: 100px; /* Larger preview size */
    max-height: 80px; /* Larger preview size */
    object-fit: cover;
    background: #0c0020;
    margin-right: 0; /* Remove extra margin */
    border: 1px solid var(--primary); /* Blue border for preview media */
}

.preview-container .remove-media {
    color: var(--error);
    background: none;
    border: none;
    font-size: 1.5em; /* Larger icon */
    cursor: pointer;
    margin-left: 0.5em; /* Adjusted margin */
    transition: color 0.2s ease;
    align-self: flex-start; /* Align to the top of the flex item */
}

.preview-container .remove-media:hover {
    color: #ff0000;
}

/* Approved Posts Section */
#approved-posts {
    margin-top: 1.5rem; /* Adjusted margin */
}

.approved-card {
    background: var(--approved-card-bg);
    padding: 1.5rem; /* Increased padding */
    gap: 0.8rem;
}

.approved-card .edit-actions {
    justify-content: flex-end; /* Align buttons to the right */
}

/* Notifications */
#notification-container {
    position: fixed;
    top: 1.8rem; /* Slightly lower */
    right: 1.8rem; /* Slightly more to the right */
    width: 320px; /* Slightly wider */
    z-index: 999999;
    display: flex;
    flex-direction: column;
    gap: 16px; /* Increased gap */
    pointer-events: none; /* Allows clicks to pass through */
}

.notify {
    padding: 1.1em 1.2em; /* Increased padding */
    border-radius: 12px; /* More rounded */
    background: var(--secondary);
    color: var(--white);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* Stronger shadow */
    font-size: 1.05em;
    display: flex;
    align-items: center; /* Center vertically */
    gap: 12px; /* Increased gap */
    opacity: 0;
    transform: translateY(-40px); /* More aggressive initial transform */
    animation: fadeNotify 0.6s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncier animation */
    pointer-events: auto; /* Re-enable pointer events for the notification itself */
}

@keyframes fadeNotify {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.notify.success {
    border-left: 8px solid var(--success); /* Thicker border */
}

.notify.error {
    border-left: 8px solid var(--error); /* Thicker border */
}

/* Media Queries for Responsiveness */
@media (max-width: 768px) {
    header {
        flex-direction: column;
        align-items: flex-start;
        padding: 1.2rem 1rem;
    }
    header h1 {
        text-align: center;
        width: 100%;
        margin-bottom: 0.8rem;
    }
    .logout-btn {
        margin: 0 auto;
    }
    .news-card,
    .approved-card {
        padding: 1.2rem;
    }
    .news-card .news-actions,
    .approved-card .edit-actions {
        flex-direction: column;
        gap: 0.6rem;
    }
    .news-card .news-actions button,
    .approved-card .edit-actions button {
        width: 100%;
        padding: 0.6em;
    }
}

@media (max-width: 650px) {
    .form-card,
    #new-post-section {
        max-width: 95vw;
        padding: 1.5rem;
    }
    #notification-container {
        right: 0.8rem;
        left: 0.8rem;
        width: auto;
        top: 1rem;
    }
    body {
        font-size: 0.95em;
    }
    main {
        padding: 0 0.8rem;
    }
    .news-card,
    .approved-card {
        max-width: 95vw;
        margin: 0 auto;
    }
    .approved-card {
        padding: 1rem 0.8rem;
    }
    .news-card .news-title,
    .approved-card .post-title {
        font-size: 1.15em;
    }
    .form-card h2 {
        font-size: 1.5rem;
    }
    #new-post-section h2 {
        font-size: 1.7rem;
    }
}

@media (max-width: 480px) {
    .centered-section {
        padding: 0.5rem;
    }
    .form-card {
        padding: 1.2rem;
    }
    .main-btn, .logout-btn {
        font-size: 1em;
        padding: 0.7em;
    }
    header h1 {
        font-size: 1.6rem;
    }
    header #user-fullname {
        font-size: 1.3rem;
    }
}
    </style>
    <style>
        
        /* ==== STYLE NA ADMIN POLL FORM ==== */
.admin-poll-post-container {
    width: 90%;
    max-width: 650px;
    margin: 20px auto;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    background-color: #f7f7f7;
    border-left: 5px solid #ff5722;
}

.admin-poll-post-container h3 {
    text-align: center;
    color: #333;
    margin-bottom: 25px;
    border-bottom: 1px dashed #ccc;
    padding-bottom: 10px;
}

#poll-post-form textarea,
#poll-post-form input[type="text"] {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1em;
    box-sizing: border-box;
    transition: border-color 0.3s;
}

#poll-text {
    min-height: 80px;
    resize: vertical;
}

.option-input-group {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.candidate-option {
    margin-bottom: 0 !important;
}

#add-option-button {
    background-color: #4CAF50;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    margin-bottom: 15px;
    transition: background-color 0.3s;
}

#add-option-button:hover {
    background-color: #45a049;
}

#submit-poll-button {
    background-color: #007bff;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: bold;
    width: 100%;
    transition: background-color 0.3s;
}

#submit-poll-button:hover {
    background-color: #0056b3;
}

/* Push Notification Style */
#push-notification-container {
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    transition: opacity 0.5s ease;
    opacity: 0;
    height: auto;
}

.notification-success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
    opacity: 1;
}

.notification-error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
    opacity: 1;
}

.notification-hidden {
    opacity: 0;
    height: 0;
    padding: 0;
    margin-bottom: 0;
}

/* ==== STYLE NA POLL POST A CIKIN APPROVED CARD ==== */
.poll-card {
    border: 2px solid #ff5722 !important;
    padding: 20px !important;
}

.poll-header-approved {
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px dashed #ddd;
}

.poll-text-approved {
    font-size: 1.15em;
    font-weight: bold;
    color: #333;
    margin-bottom: 8px;
}

.poll-options-list {
    margin-bottom: 15px;
}

.total-votes-approved {
    text-align: center;
    font-size: 1em;
    color: #666;
    padding-top: 10px;
    border-top: 1px dashed #eee;
}

.total-votes-approved strong {
    color: #ff5722;
}

/* Kashi na style na kowane zaɓi (kamar yadda aka gyara a baya) */
.candidate-item {
    margin-bottom: 10px;
    padding: 8px 0;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.vote-button-circle {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 3px solid #007bff;
    background-color: transparent;
    margin-right: 15px;
    cursor: pointer;
    flex-shrink: 0;
}

.candidate-details-content {
    flex-grow: 1;
}
        
.candidate-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
    color: #444;
    margin-bottom: 5px;
}

.candidate-name {
    font-size: 1.1em;
    color: #333;
}

.vote-count {
    background-color: #ff5722;
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.85em;
    min-width: 30px;
    text-align: center;
}

.progress-bar-container {
    height: 18px; 
    background-color: #e9ecef;
    border-radius: 9px;
    overflow: hidden;
    position: relative;
}

.progress-bar {
    height: 100%;
    width: 0%; 
    border-radius: 9px;
    transition: width 1.5s cubic-bezier(0.25, 1, 0.5, 1);
    position: relative;
}

/* Launuka Daban-daban */
.poll-options-list .candidate-item:nth-child(1) .progress-bar { background: linear-gradient(to right, #00BCD4, #03A9F4); } 
.poll-options-list .candidate-item:nth-child(2) .progress-bar { background: linear-gradient(to right, #FF9800, #FFC107); } 
.poll-options-list .candidate-item:nth-child(3) .progress-bar { background: linear-gradient(to right, #4CAF50, #8BC34A); } 
.poll-options-list .candidate-item:nth-child(4) .progress-bar { background: linear-gradient(to right, #E91E63, #F48FB1); } 
.poll-options-list .candidate-item:nth-child(5) .progress-bar { background: linear-gradient(to right, #9C27B0, #BA68C8); } 

.progress-bar::after {
    content: attr(data-percentage);
    position: absolute;
    top: 50%;
    right: 5px;
    transform: translateY(-50%);
    color: white;
    font-size: 0.85em;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
    z-index: 2;
}

/* Tsarin Advanced: Kashi a waje idan bar yayi gajere */
.progress-bar[style*="width: 0%"]::after,
.progress-bar[style*="width: 1%"]::after,
.progress-bar[style*="width: 2%"]::after,
.progress-bar[style*="width: 3%"]::after,
.progress-bar[style*="width: 4%"]::after,
.progress-bar[style*="width: 5%"]::after,
.progress-bar[style*="width: 6%"]::after,
.progress-bar[style*="width: 7%"]::after {
    right: auto;
    left: 5px;
    color: #333;
    text-shadow: none;
}
    </style>
</head>
<body>
    <div id="preloader">
        <div class="loader"></div>
    </div>

    <div id="notification-container"></div>

    <section id="login-section" class="centered-section">
        <div class="form-card">
            <h2><i class="fas fa-user-secret"></i> Shiga Agents</h2>
            <form id="login-form" autocomplete="off">
                <div class="form-group">
                    <label for="email">Imel</label>
                    <input type="email" id="email" required placeholder="Shigar da imel">
                </div>
                <div class="form-group">
                    <label for="password">Kalmar sirri</label>
                    <input type="password" id="password" required placeholder="Shigar da kalmar sirri">
                </div>
                <button type="submit" class="main-btn"><i class="fas fa-sign-in-alt"></i> Shiga</button>
            </form>
        </div>
    </section>

    <section id="dashboard-section" style="display:none;">
        <header>
            <h1>Barka da zuwa Agents, <span id="user-fullname"></span>!</h1>
            <button id="logout-btn" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Fita</button>
        </header>
        <main>
            <div class="actions">
                <button id="load-news-btn" class="main-btn"><i class="fas fa-globe"></i> Labaran Wasanni na Duniya</button>
            </div>

            <section id="news-list-section">
                </section>

            <hr>

            <section id="new-post-section">
                <h2>Sabon Post</h2>
                <form id="post-form">
                    <div class="form-group media-upload-group">
                        <label for="post-img1"><i class="fas fa-image"></i> Hoto 1</label>
                        <input type="file" id="post-img1" accept="image/*" class="file-input-hidden">
                        <label for="post-img1" class="upload-icon-label"><i class="fas fa-cloud-upload-alt"></i></label>
                        <div class="preview-container" id="preview-img1"></div>
                    </div>

                    <div class="form-group media-upload-group">
                        <label for="post-img2"><i class="fas fa-image"></i> Hoto 2</label>
                        <input type="file" id="post-img2" accept="image/*" class="file-input-hidden">
                        <label for="post-img2" class="upload-icon-label"><i class="fas fa-cloud-upload-alt"></i></label>
                        <div class="preview-container" id="preview-img2"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="audio-link"><i class="fas fa-music"></i> Link na Audio</label>
                        <input type="url" id="audio-link" placeholder="Saka link na audio...">
                    </div>

                    <div class="form-group media-upload-group">
                        <label for="post-video"><i class="fas fa-video"></i> Bidiyo (max 9MB)</label>
                        <input type="file" id="post-video" accept="video/*" class="file-input-hidden">
                        <label for="post-video" class="upload-icon-label"><i class="fas fa-cloud-upload-alt"></i></label>
                        <div class="preview-container" id="preview-video"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="post-text">Rubutu</label>
                        <textarea id="post-text" rows="8" placeholder="Rubuta labarin ka..." class="full-width-textarea"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="link-img">Link na hoto (Idan ba za'a loda hoto ba)</label>
                        <input type="url" id="link-img" placeholder="Saka link na hoto...">
                    </div>

                    <div class="form-group">
                        <label for="link-video">Link na bidiyo (Idan ba za'a loda bidiyo ba)</label>
                        <input type="url" id="link-video" placeholder="Saka link na bidiyo...">
                    </div>

                    <button type="submit" class="main-btn"><i class="fas fa-plus"></i> Tura Post</button>
                </form>
            </section>
            
            <div class="admin-poll-post-container">
    <h3>Ƙirƙiri Sabon Zaɓen Wasa</h3>
    <div id="push-notification-container" class="notification-hidden">An gudanar da post cikin nasara!</div>
    
    <form id="poll-post-form">
        <textarea id="poll-text" placeholder="Rubuta tambaya ko bayani game da zaɓen (e.g., Zaku iya zabin wanda juke ganin zai yi nasara a wannan Wasa)..." required></textarea>
        
        <div id="options-container">
            </div>
        
        <button type="button" id="add-option-button">Ƙara Wani Zaɓi</button>
        
        <button type="submit" id="submit-poll-button">Gudanar da Post</button>
    </form>
</div>

            <section id="posted-list-section">
                <h2>Posts da aka amince da su</h2>
                <div id="approved-posts"></div>
            </section>
        </main>
    </section>

   <script type="module">
       
     const ALLOWED_EMAILS = [
    "harunalawali5522@gmail.com",
    "lawaliharuna943@gmail.com",
    "tauraronwasa@gmil.com"
];
const IMGUR_CLIENT_ID = "5acf7eff9c91660";
const POSTING_ID = "Posting";
const SOCIAL_MEDIA_WORKER_URL = "https://tauraronwasa.dev/socialPost";
const BASE_VIEWS_LINK = "https://tauraronwasa.pages.dev";

import { app } from './firebase.js';
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
import { getDatabase, ref, set, get, update, onValue, remove } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

const preloader = document.getElementById('preloader');
const loginSection = document.getElementById('login-section');
const dashboardSection = document.getElementById('dashboard-section');
const loginForm = document.getElementById('login-form');
const userFullName = document.getElementById('user-fullname');
const logoutBtn = document.getElementById('logout-btn');
const notificationContainer = document.getElementById('notification-container');
const postForm = document.getElementById('post-form');
const approvedPostsContainer = document.getElementById('approved-posts');

const img1Input = document.getElementById('post-img1');
const img2Input = document.getElementById('post-img2');
const audioLinkInput = document.getElementById('audio-link');
const videoInput = document.getElementById('post-video');
const postTextInput = document.getElementById('post-text');
const previewImg1 = document.getElementById('preview-img1');
const previewImg2 = document.getElementById('preview-img2');
const previewVideo = document.getElementById('preview-video');
const linkImgInput = document.getElementById('link-img');
const linkVideoInput = document.getElementById('link-video');

const pollPostForm = document.getElementById('poll-post-form');
const pollTextarea = document.getElementById('poll-text');
const optionsContainer = document.getElementById('options-container');
const addOptionButton = document.getElementById('add-option-button');
const pushNotificationContainer = document.getElementById('push-notification-container');

let currentUser = null;
let currentUserUid = null;
let observer = null;
const auth = getAuth(app);
const db = getDatabase(app);



function getNigeriaISOString(date = new Date()) {
    const n = new Date(date.getTime() + (60 * 60 * 1000));
    return n.toISOString().split('.')[0] + 'Z';
}

function showPreloader(show = true) {
    preloader.style.display = show ? 'flex' : 'none';
}

function notify(message, type = "success", timeout = 3600) {
    const div = document.createElement('div');
    div.className = `notify ${type}`;
    div.innerHTML = `<i class="fas fa-${
        type === 'success' ? 'check-circle' : 'exclamation-circle'
    }"></i> ${message}`;
    notificationContainer.appendChild(div);
    setTimeout(() => {
        div.style.opacity = "0";
        div.style.transform = "translateY(-30px)";
        setTimeout(() => div.remove(), 350);
    }, timeout);
}

function showPushNotification(message, type = "success") {
    pushNotificationContainer.textContent = message;
    pushNotificationContainer.className = '';
    pushNotificationContainer.classList.add(type === 'success' ? 'notification-success' : 'notification-error');
    pushNotificationContainer.classList.remove('notification-hidden');
    setTimeout(() => {
        pushNotificationContainer.classList.add('notification-hidden');
    }, 5000);
}

function resetPreviews() {
    previewImg1.innerHTML = "";
    previewImg2.innerHTML = "";
    previewVideo.innerHTML = "";
}

function fadeUpOnScroll() {
    if (observer) observer.disconnect();
    observer = new window.IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.21 });
    document.querySelectorAll('.approved-card:not(.visible)').forEach(card => {
        observer.observe(card);
    });
}

onAuthStateChanged(auth, (user) => {
    if (user) {
        currentUser = user;
        currentUserUid = user.uid;
        loadUserProfile();
        showDashboard();
    } else {
        showLogin();
    }
    showPreloader(false);
});

// ... (Login and Logout event listeners remain unchanged) ...
loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    showPreloader(true);
    const email = loginForm.email.value.trim().toLowerCase();
    const password = loginForm.password.value;
    if (!ALLOWED_EMAILS.includes(email)) {
        showPreloader(false);
        notify("Ba a amince da wannan imel ba", "error");
        return;
    }
    try {
        const { user } = await signInWithEmailAndPassword(auth, email, password);
        currentUser = user;
        currentUserUid = user.uid;
        await loadUserProfile();
        showDashboard();
        showPreloader(false);
        notify("An shiga cikin nasara!", "success");
    } catch (err) {
        showPreloader(false);
        notify("Kuskure wajen shiga: " + err.message, "error");
    }
});

logoutBtn.addEventListener('click', () => {
    signOut(auth).then(() => {
        showLogin();
        notify("An fita cikin nasara", "success");
    });
});

async function loadUserProfile() {
    const userRef = ref(db, 'users/' + currentUserUid + '/fullName');
    const snapshot = await get(userRef);
    let fullName = "";
    if (snapshot.exists()) {
        fullName = snapshot.val();
    } else {
        fullName = currentUser.email.split('@')[0];
    }
    userFullName.textContent = fullName;
}

function showLogin() {
    loginSection.style.display = "flex";
    dashboardSection.style.display = "none";
}

function showDashboard() {
    loginSection.style.display = "none";
    dashboardSection.style.display = "block";
    loadApprovedPosts();
}

// ... (postForm event listener, uploadToImgur, and handlePreview remain unchanged) ...
postForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    showPreloader(true);
    const text = postTextInput.value.trim();
    const audioLink = audioLinkInput.value.trim();
    let photoLink1 = linkImgInput.value.trim();
    let photoLink2 = "";
    let videoLink = linkVideoInput.value.trim();
    if (!text && !img1Input.files.length && !img2Input.files.length && !videoInput.files.length && !photoLink1 && !videoLink && !audioLink) {
        showPreloader(false);
        notify("Dole ne a sami rubutu, hoto, bidiyo ko audio link.", "error");
        return;
    }
    if (img1Input.files.length > 0) {
        try {
            photoLink1 = await uploadToImgur(img1Input.files[0]);
        } catch (error) {
            notify("Kuskure wajen loda hoto na farko!", "error");
            showPreloader(false);
            return;
        }
    }
    if (img2Input.files.length > 0) {
        try {
            photoLink2 = await uploadToImgur(img2Input.files[0]);
        } catch (error) {
            notify("Kuskure wajen loda hoto na biyu!", "error");
            showPreloader(false);
            return;
        }
    }
    if (videoInput.files.length > 0) {
        const file = videoInput.files[0];
        if (file.size > 9 * 1024 * 1024) {
            showPreloader(false);
            notify("Bidiyo bai kamata ya fi 9MB ba.", "error");
            return;
        }
        try {
            videoLink = await uploadToImgur(file, true);
        } catch (error) {
            notify("Kuskure wajen loda bidiyo!", "error");
            showPreloader(false);
            return;
        }
    }
    const postid = "post-" + Date.now();
    const postData = {
        postid: postid,
        text: text,
        audioLink: audioLink,
        photoLink1: photoLink1 || null,
        photoLink2: photoLink2 || null,
        videoLink: videoLink || null,
        tauraronwasaAudiolink: null,
        see: 0,
        like: 0,
        icons: 0,
        share: 0,
        postingTime: getNigeriaISOString(),
        userId: currentUserUid,
        userName: userFullName.textContent,
        userPhoto: ""
    };
    try {
        const postRef = ref(db, `${POSTING_ID}/${postid}`);
        await set(postRef, postData);
        showPreloader(false);
        notify("An tura post cikin nasara!", "success");
        postForm.reset();
        resetPreviews();
        loadApprovedPosts();
        let socialPostPayload;
        if (text && photoLink1) {
            socialPostPayload = {
                postId: postid,
                title: text.substring(0, 70) + (text.length > 70 ? "..." : ""),
                viewsLink: `${BASE_VIEWS_LINK}?postId=${postid}`,
                imageUrl: photoLink1,
                timestamp: getNigeriaISOString()
            };
        } else if (audioLink && photoLink1) {
            socialPostPayload = {
                postId: postid,
                title: text ? text.substring(0, 70) + (text.length > 70 ? "..." : "") : "Sabon Audio Post",
                viewsLink: `${BASE_VIEWS_LINK}?postId=${postid}`,
                imageUrl: photoLink1,
                timestamp: getNigeriaISOString(),
                audioUrl: audioLink
            };
        }
        if (socialPostPayload) {
            await sendToSocialMediaWorker(socialPostPayload);
        }
    } catch (err) {
        showPreloader(false);
        notify("Kuskure wajen tura post: " + err.message, "error");
    }
});

async function uploadToImgur(file, isVideo = false) {
    const formData = new FormData();
    formData.append(isVideo ? "video" : "image", file);
    try {
        const resp = await fetch("https://api.imgur.com/3/image", {
            method: "POST",
            headers: { Authorization: "Client-ID " + IMGUR_CLIENT_ID },
            body: formData
        });
        const data = await resp.json();
        if (data.success && data.data && data.data.link) {
            notify(`An loda ${isVideo ? 'bidiyo' : 'hoto'} cikin nasara!`, "success");
            return data.data.link;
        }
        throw new Error(data.data.error || "Unknown Imgur upload error");
    } catch (err) {
        console.error("Imgur upload error:", err);
        notify(`Kuskure wajen loda ${isVideo ? 'bidiyo' : 'hoto'}!`, "error");
        throw err;
    }
}

img1Input.addEventListener('change', e => handlePreview(img1Input, previewImg1, "img"));
img2Input.addEventListener('change', e => handlePreview(img2Input, previewImg2, "img"));
videoInput.addEventListener('change', e => handlePreview(videoInput, previewVideo, "video"));

function handlePreview(input, previewElem, type) {
    previewElem.innerHTML = "";
    if (!input.files.length) return;
    const file = input.files[0];
    const url = URL.createObjectURL(file);
    let el;
    if (type === "img") {
        el = document.createElement('img');
        el.src = url;
    } else {
        el = document.createElement('video');
        el.src = url;
        el.controls = true;
    }
    const removeBtn = document.createElement('button');
    removeBtn.className = "remove-media";
    removeBtn.innerHTML = "<i class='fas fa-times'></i>";
    removeBtn.onclick = () => {
        input.value = "";
        previewElem.innerHTML = "";
        URL.revokeObjectURL(url);
    };
    previewElem.appendChild(el);
    previewElem.appendChild(removeBtn);
}


// ... (Wani ɓangare na code ɗin) ...

async function loadApprovedPosts() {
    approvedPostsContainer.innerHTML = "";
    const postRef = ref(db, POSTING_ID);
    onValue(postRef, (snapshot) => {
        approvedPostsContainer.innerHTML = "";
        if (snapshot.exists()) {
            // 🛑 GYARARRE A NAN: Ingantaccen jeri na Sabo-sama (Newest-first)
            const posts = Object.values(snapshot.val()).sort((a, b) => {
                // Tabbatar da an sami lokacin kirkiro don jeri mai inganci
                const timeA = new Date(a.postingTime).getTime() || 0;
                const timeB = new Date(b.postingTime).getTime() || 0;
                
                // Idan lokutan suna daidai (ko babu), yi amfani da postid a matsayin mai raba gardama.
                // Domin postid yana ƙunshe da Date.now() ko wani random string mai daidaitawa.
                if (timeB === timeA) {
                    if (b.postid > a.postid) return -1; // Sabo a sama
                    if (b.postid < a.postid) return 1; // Tsoho a kasa
                    return 0;
                }
                
                // Jere na lokaci (Sabo zuwa Tsoho: timeB - timeA)
                return timeB - timeA;
            });
            
            
            posts.forEach(post => {
                const isPoll = post.isPoll === true;
                const card = document.createElement('div');
                card.className = "approved-card";
                
                if (isPoll) {
                    card.classList.add('poll-card');
                    card.innerHTML = createPollCardHTML(post);
                    updatePollCardResults(card, post);
                } else {
                    card.innerHTML = `
                        ${post.photoLink1 ? `<img src="${post.photoLink1}" class="post-img" alt="">` : ""}
                        ${post.photoLink2 ? `<img src="${post.photoLink2}" class="post-img" alt="">` : ""}
                        ${post.videoLink ? `<video src="${post.videoLink}" class="post-video" controls></video>` : ""}
                        ${post.audioLink ? `<audio src="${post.audioLink}" class="post-audio" controls></audio>` : ""}
                        <div class="post-content" contenteditable="false">${post.text}</div>
                        <div class="post-meta"><i class="fas fa-calendar"></i> ${formatDate(post.postingTime)}</div>
                        <div class="edit-actions">
                            <button class="delete-btn" onclick="window.deletePost('${post.postid}')"><i class="fas fa-trash"></i></button>
                            <button class="edit-btn"><i class="fas fa-edit"></i></button>
                            <button class="save-btn" style="display:none;"><i class="fas fa-save"></i></button>
                        </div>
                    `;
                    card.querySelector('.delete-btn').onclick = async () => {
                        await remove(ref(db, `${POSTING_ID}/${post.postid}`));
                        notify("An goge post cikin nasara!", "success");
                        card.remove();
                    };
                    card.querySelector('.edit-btn').onclick = () => {
                        const contentDiv = card.querySelector('.post-content');
                        contentDiv.setAttribute('contenteditable', 'true');
                        contentDiv.focus();
                        card.querySelector('.save-btn').style.display = '';
                        card.querySelector('.edit-btn').style.display = 'none';
                    };
                    card.querySelector('.save-btn').onclick = async () => {
                        const contentDiv = card.querySelector('.post-content');
                        const newText = contentDiv.innerText.trim();
                        await update(ref(db, `${POSTING_ID}/${post.postid}`), { text: newText });
                        contentDiv.setAttribute('contenteditable', 'false');
                        card.querySelector('.save-btn').style.display = 'none';
                        card.querySelector('.edit-btn').style.display = '';
                        notify("An adana gyara cikin nasara!", "success");
                    };
                }
                
                approvedPostsContainer.appendChild(card);
            });
            fadeUpOnScroll();
        } else {
            notify("Babu posts da aka amince da su tukuna.", "info");
        }
    });
}

/**
 * Yana samar da HTML na Poll Card don dashboard, yana nuna bayanan zaɓe.
 */
function createPollCardHTML(post) {
    let optionsHTML = '';
    let totalVotes = 0;
    const candidates = [];
    
    // Tattara 'yan takara (har zuwa 5)
    for (let i = 1; i <= 5; i++) {
        if (post[`takara${i}`]) {
            const votes = post[`zabi${i}`] || 0;
            totalVotes += votes;
            candidates.push({ name: post[`takara${i}`], votes: votes, index: i });
        }
    }

    candidates.forEach(candidate => {
        // A nan muna amfani da data-voted don alamta button a UI (misali kawai)
        optionsHTML += `
            <div class="candidate-item" data-votes="${candidate.votes}" data-index="${candidate.index}" data-postid="${post.postid}">
                <div class="vote-button-circle" onclick="window.voteOnApprovedPost(this, '${post.postid}', ${candidate.index})" title="Gwaji/Ƙara Ƙuri'a" data-voted="false"></div>
                <div class="candidate-details-content">
                    <div class="candidate-info">
                        <span class="candidate-name">${candidate.name}</span>
                        <span class="vote-count">${candidate.votes}</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 0%;" data-percentage="0%"></div>
                    </div>
                </div>
            </div>
        `;
    });

    return `
        <div class="poll-header-approved">
            <div class="poll-text-approved">${post.text}</div>
            <div class="post-meta"><i class="fas fa-calendar"></i> ${formatDate(post.postingTime)}</div>
        </div>
        <div class="poll-options-list">
            ${optionsHTML}
        </div>
        <div class="total-votes-approved">
            Jimillar Zaɓe: <strong class="total-votes-display">${totalVotes}</strong>
        </div>
        <div class="edit-actions">
            <button class="delete-btn" onclick="window.deletePost('${post.postid}')"><i class="fas fa-trash"></i> Goge Post</button>
        </div>
    `;
}


function updatePollCardResults(card, post) {
    let totalVotes = 0;
    const candidateItems = card.querySelectorAll('.candidate-item');

    // 1. Lissafa Jimillar Zaɓe
    candidateItems.forEach(item => {
        const index = item.getAttribute('data-index');
        totalVotes += post[`zabi${index}`] || 0;
    });

    // 2. Sabunta Total Votes Display
    const totalVotesDisplay = card.querySelector('.total-votes-display');
    if (totalVotesDisplay) {
        totalVotesDisplay.textContent = totalVotes;
    }

    // 3. Sabunta kowane Zaɓi da Progress Bar
    candidateItems.forEach(item => {
        const index = item.getAttribute('data-index');
        const votes = post[`zabi${index}`] || 0;
        // Kashi (%) an lissafa shi daidai
        const percentage = totalVotes === 0 ? 0 : Math.round((votes / totalVotes) * 100); 
        
        const progressBar = item.querySelector('.progress-bar');
        const voteCountDisplay = item.querySelector('.vote-count');

        if (voteCountDisplay) voteCountDisplay.textContent = votes;
        
        if (progressBar) {
            // Sanya data-percentage kuma canza width don aiki da style
            progressBar.setAttribute('data-percentage', percentage + '%'); 
            progressBar.style.width = percentage + '%';
        }
        
        item.setAttribute('data-votes', votes);
    });
}


window.voteOnApprovedPost = async (button, postId, optionIndex) => {
    const optionKey = `zabi${optionIndex}`;
    const postRef = ref(db, `${POSTING_ID}/${postId}`);

    try {
        const snapshot = await get(postRef);
        if (snapshot.exists()) {
            const currentVotes = snapshot.val()[optionKey] || 0;
            const newVoteCount = currentVotes + 1;
            
            const updateData = {};
            updateData[optionKey] = newVoteCount;
            
            await update(postRef, updateData);
            
            button.style.backgroundColor = '#007bff';
            button.style.color = 'white'; // Sanya checkmark fari (idan ya kasance)
            button.innerHTML = '<i class="fas fa-check"></i>'; // Ƙara alamar check
            button.onclick = null; // Kashe shi bayan dannawa
            notify("An kara ƙuri'a cikin nasara! (Dashboard Preview)", "success", 2000);
            
        } else {
            notify("Ba a sami post ɗin ba", "error");
        }
    } catch (error) {
        notify("Kuskure wajen ƙara ƙuri'a: " + error.message, "error");
    }
};

window.deletePost = async (postId) => {
    await remove(ref(db, `${POSTING_ID}/${postId}`));
    notify("An goge post cikin nasara!", "success");
};

async function sendToSocialMediaWorker(payload) {
    try {
        const response = await fetch(SOCIAL_MEDIA_WORKER_URL, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        });
        const result = await response.json();
        if (!response.ok) {
            throw new Error(result.message || `HTTP error! status: ${response.status}`);
        }
        notify(result.message || "An aika post zuwa social media!", "success");
    } catch (error) {
        console.error("Error sending to social media worker:", error);
        notify("Akwai matsala wajen tura post zuwa social media: " + error.message, "error");
    }
}

function formatDate(iso) {
    if (!iso) return "";
    const d = new Date(iso);
    return d.toLocaleString("ha-NG", { hour: "2-digit", minute: "2-digit", day: "numeric", month: "short", year: "numeric" });
}

window.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => showPreloader(false), 600);
});



let optionCounter = 1; // Fara da 1

function addPollOptionInput(defaultValue = '') {
    // Iyakance zuwa 5
    if (optionCounter > 5) {
        addOptionButton.style.display = 'none';
        showPushNotification("An amince da 'yan takara 5 ne kawai.", "error");
        return;
    }
    
    const inputGroup = document.createElement('div');
    inputGroup.className = 'option-input-group';
    inputGroup.innerHTML = `
        <input type="text" class="candidate-option" placeholder="Sunan Ɗan Takara ${optionCounter}" value="${defaultValue}" required>
    `;
    optionsContainer.appendChild(inputGroup);
    
    optionCounter++;
    
    // Boye maɓallin idan ya cika 5
    if (optionCounter > 5) { 
        addOptionButton.style.display = 'none';
    }
}

addOptionButton.addEventListener('click', () => {
    addPollOptionInput();
});

pollPostForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    showPreloader(true);
    
    const text = pollTextarea.value.trim();
    const options = Array.from(optionsContainer.querySelectorAll('.candidate-option'))
                            .map(input => input.value.trim())
                            .filter(name => name); 

    if (!text || options.length < 2) {
        showPreloader(false);
        showPushNotification("Dole a rubuta tambaya kuma a saka 'yan takara biyu aƙalla.", "error");
        return;
    }
    
    if (options.length > 5) {
        // Wannan bai kamata ya faru ba saboda logic na addPollOptionInput, amma don tabbatarwa
        showPreloader(false);
        showPushNotification("An amince da 'yan takara 5 ne kawai. Da fatan za a goge ɗaya.", "error");
        return;
    }

    const postid = "vote-" + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 9);
    
    const postData = {
        postid: postid,
        isPoll: true, 
        text: text,
        postingTime: getNigeriaISOString(),
        userId: currentUserUid,
        userName: userFullName.textContent,
        userPhoto: "",
        see: 0 
    };
    
    options.forEach((name, index) => {
        postData[`takara${index + 1}`] = name;
        postData[`zabi${index + 1}`] = 0; 
    });

    try {
        const postRef = ref(db, `${POSTING_ID}/${postid}`);
        await set(postRef, postData);

        showPreloader(false);
        showPushNotification("An gudanar da post na zaɓe cikin nasara!", "success");
        
        // Sake saita form
        pollPostForm.reset();
        optionsContainer.innerHTML = '';
        optionCounter = 1;
        addPollOptionInput("Ɗan Takara Na Farko"); 
        addPollOptionInput("Ɗan Takara Na Biyu"); 
        addOptionButton.style.display = ''; 
        loadApprovedPosts(); 

        const socialPostPayload = {
            postId: postid,
            title: text.substring(0, 70) + (text.length > 70 ? "..." : ""),
            viewsLink: `${BASE_VIEWS_LINK}?postId=${postid}`,
            timestamp: getNigeriaISOString(),
            pollOptions: options.join(', ') 
        };
        await sendToSocialMediaWorker(socialPostPayload);

    } catch (err) {
        showPreloader(false);
        showPushNotification("Kuskure wajen gudanar da post na zaɓe: " + err.message, "error");
    }
});

// Fara da 'yan takara 2
addPollOptionInput("Ɗan Takara Na Farko"); 
addPollOptionInput("Ɗan Takara Na Biyu");


   </script >
</body>
</html>
