<!DOCTYPE html>
<html lang="ha">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TauraronWasa KaiTsaye</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:400,600&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <style>
  body {
  margin: 0;
  padding: 0;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(to bottom, #180022, #300040);
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;
  color: #fff;
  min-height: 100vh;
}
#preloader {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(24,0,34,0.9);
  z-index: 2000;
  display: flex;
  align-items: center;
  justify-content: center;
}
.loader {
  border: 6px solid #fff;
  border-top: 6px solid #7c31ff;
  border-radius: 50%;
  width: 60px; height: 60px;
  animation: spin 1.1s linear infinite;
}
@keyframes spin {
  to { transform: rotate(360deg);}
}
.hidden { display: none !important; }
#login-section, #verify-section, #main-section {
  max-width: 400px;
  margin: 60px auto;
  background: rgba(24,0,34,0.8);
  padding: 32px 24px;
  border-radius: 16px;
  box-shadow: 0 8px 32px #0003;
}
#login-section h2, #verify-section h3 {
  margin-bottom: 18px;
  text-align: center;
}
form label { display: block; margin: 12px 0 6px 0;}
form input, textarea {
  width: 100%;
  padding: 10px;
  border-radius: 6px;
  border: none;
  margin-bottom: 18px;
  font-size: 1em;
  background: #2d0040;
  color: #fff;
}
form input:focus, textarea:focus { outline: 2px solid #7c31ff; }
form button {
  width: 100%;
  background: #7c31ff;
  color: #fff;
  padding: 12px;
  border: none;
  border-radius: 6px;
  font-size: 1.1em;
  cursor: pointer;
  transition: background 0.2s;
}
form button:hover { background: #a884ff; }
#push-container {
  position: fixed;
  top: 40%;
  right: 70px;
  min-width: 220px;
  max-width: 350px;
  z-index: 4000;
}
.push-notification {
  background: #7c31ff;
  color: #fff;
  padding: 16px 22px;
  border-radius: 8px;
  margin-bottom: 10px;
  font-weight: 500;
  box-shadow: 0 4px 18px #0005;
  display: flex;
  align-items: center;
  gap: 8px;
  animation: fadein 0.5s, fadeout 0.5s 3.5s;
}
.push-notification.error { background: #d32f2f; }
.push-notification.success { background: #43a047; }
@keyframes fadein { from { opacity: 0; right: 0; } to { opacity: 1; right: 24px;} }
@keyframes fadeout { from { opacity: 1;} to { opacity: 0;} }
#main-section header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 18px;
}
#main-section header h2 {
  font-size: 1.3em;
  margin: 0;
}
#logout-btn {
  background: transparent;
  color: #fff;
  font-size: 1.3em;
  border: none;
  cursor: pointer;
  transition: color 0.2s;
}
#logout-btn:hover { color: #ff5757; }
.post-container {
  background: rgba(24,0,34,0.9);
  border-radius: 16px;
  padding: 28px 18px;
  box-shadow: 0 4px 24px #0003;
  margin-bottom: 32px;
}
.upload-area {
  display: flex;
  gap: 16px;
  margin-bottom: 12px;
}
.upload-area button {
  background: #22103c;
  color: #fff;
  font-size: 1em;
  border: none;
  padding: 10px 18px;
  border-radius: 7px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: background 0.2s;
}
.upload-area button:hover { background: #7c31ff; }
.link-inputs {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 10px;
}
.link-inputs input {
  flex: 1;
  min-width: 140px;
}
.link-inputs button {
  background: #22103c;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 10px 12px;
  cursor: pointer;
  transition: background 0.2s;
}
.link-inputs button:hover { background: #7c31ff; }
#online-links {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 10px;
}
.online-link {
  display: 
  gap: 0px;
}
.online-link input {
  flex: 1;
}
#media-preview {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 16px;
  min-height: 56px;
}
.media-item {
  position: relative;
  border-radius: 7px;
  overflow: hidden;
  background: #2d0040;
  box-shadow: 0 2px 8px #0003;
}
.media-item img,
.media-item video {
  display: block;
  max-width: 110px;
  max-height: 90px;
  min-width: 68px;
  min-height: 50px;
}
.media-remove {
  position: absolute;
  top: 3px;
  left: 3px;
  background: #d32f2f;
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 22px;
  height: 22px;
  font-size: 1em;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  display: flex;
  z-index: 2;
  opacity: 0.9;
  transition: background 0.2s;
}
.media-remove:hover { background: #ff5757; }
textarea#written-post {
  width: 100%;
  border-radius: 8px;
  padding: 12px;
  font-size: 1em;
  border: none;
  background: #2d0040;
  color: #fff;
  margin-bottom: 18px;
  resize: vertical;
  min-height: 56px;
  box-shadow: 0 1px 4px #0002;
}
#submit-post {
  width: 100%;
  background: #7c31ff;
  color: #fff;
  font-size: 1.1em;
  border: none;
  padding: 13px;
  border-radius: 7px;
  cursor: pointer;
  margin-top: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
  justify-content: center;
  transition: background 0.2s;
}
#submit-post:hover { background: #a884ff; }
button {
  background: #22103c;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 10px 12px;
  cursor: pointer;
  transition: background 0.2s;
}


input{
   background: #22103c;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 10px 12px;
  cursor: pointer;
  transition: background 0.2s; 
}
  .logo-inputs {
    margin: 10px 0;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .logo-input-group {
    display: flex;
    gap: 5px;
    align-items: center;
  }
  .logo-input-group input {
    flex: 1;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
    .game-post-item {
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
    }
    .game-post-item input {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .game-post-item h4 {
      margin-top: 0;
      color: #333;
    }
    
    
.menu-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 20px;
}

.toggle-button {
  background-color: blue;
  color: black;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.toggle-button:hover {
  background-color: #0056b3;
}


.menu-container {
  display: none; 
  position: fixed; 
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: black;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  padding: 20px;
  z-index: 1000;
  width: 90%;
  max-width: 600px;
  max-height: 80vh; 
  overflow-y: auto; 
}


.menu-container.show {
  display: block;
}


.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  cursor: pointer;
  color: blue;
  transition: color 0.3s;
}

.close-btn:hover {
  color: #333;
}

.team-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 15px;
  padding: 10px;
  background-color: black;
  border: 1px solid #eee;
  border-radius: 5px;
}

.team-info {
  display: flex;
  align-items: center;
}

.team-logo {
  width: 30px;
  height: 30px;
  margin-right: 15px;
}

.team-name {
  font-weight: bold;
}

.copy-buttons {
  display: flex;
  gap: 10px;
}

.copy-btn {
  background-color: #28a745;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

.copy-btn:hover {
  background-color: #218838;
}


.notification {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #333;
  color: white;
  padding: 15px;
  border-radius: 5px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  display: none;
  opacity: 0;
  transition: opacity 0.5s ease-in-out;
  z-index: 1001;
}

.notification.show {
  display: block;
  opacity: 1;
}
    
  </style>
</head>
<body>
  <div id="preloader">
    <div class="loader"></div>
  </div>
  
  <div id="push-container"></div>
  
  <section id="login-section">
    <form id="login-form" autocomplete="off">
      <h2>Barka da zuwa TauraronWasa</h2>
      <label for="login-email">Imel</label>
      <input type="email" id="login-email" placeholder="Shigar da imel ɗinka" required>
      <label for="login-password">Kalmar sirri</label>
      <input type="password" id="login-password" placeholder="Shigar da kalmar sirri" required>
      <button type="submit">Shiga</button>
    </form>
  </section>
  
  <section id="verify-section" class="hidden">
    <form id="verify-form">
      <h3>Barka da zuwa TauraronWasa <span id="user-fullname"></span></h3>
      <p>Saka kalmar tabbatarwa kafin a cigaba:</p>
      <input type="password" id="verify-password" placeholder="Kalmar tabbatarwa" required>
      <button type="submit">Tabbatar</button>
    </form>
  </section>
  
  <section id="main-section" class="hidden">
    <header>
      <h2>Shafin Post Na Kai Tsaye Tare Mai Gabatarwa<span id="header-fullname"></span>!</h2>
      <button id="logout-btn" title="Fita"><i class="fas fa-sign-out-alt"></i></button>
    </header>
    <div class="post-container">
      <div class="upload-area">
        <button id="upload-img-btn" type="button" title="Loda Hoto">
          <i class="fas fa-image"></i> Loda Hoto 
        </button>
        <button id="upload-video-btn" type="button" title="Loda Bidiyo">
          <i class="fas fa-video"></i> Loda Bidiyo 
        </button>
        <input type="file" accept="image/*" id="img-input" multiple hidden>
        <input type="file" accept="video/*" id="video-input" hidden>
      </div>
      
      <div class="link-inputs">
        <input type="url" id="video-link" placeholder="Shigar da link na bidiyo">
        
        <input type="url" id="image-link" placeholder="Shigar da link na hoto">
        <button id="add-image-link" type="button"><i class="fas fa-plus"></i> Saka Link Hoto</button>
      </div>
      
      <div class="audio-inputs">
        <input type="text" id="audio-link" placeholder="Saka audio link...">
      </div>
      
      <div class="audio-inputs2">
        <input type="text" id="radio-audio-link" placeholder="Saka Rediyo Audio Link...">
      </div>
      
      <div class="game-post-section">
        <h3>Post Na Wasanni (Har zuwa 3)</h3>
        <div id="game-posts-container">
          <div class="game-post-item" id="game-post-1">
            <h4>Wasa Na 1</h4>
            <input type="url" class="logo-link-team1" data-game-idx="1" placeholder="Logo Link Kungiya 1 (Wasa 1)">
            <input type="text" class="team-name-team1" data-game-idx="1" placeholder="Sunan Kungiya 1 (Wasa 1)">
            <input type="url" class="logo-link-team2" data-game-idx="1" placeholder="Logo Link Kungiya 2 (Wasa 1)">
            <input type="text" class="team-name-team2" data-game-idx="1" placeholder="Sunan Kungiya 2 (Wasa 1)">
            <input type="datetime-local" class="game-time" data-game-idx="1" placeholder="Lokacin Fara Wasa 1">
            <input type="url" class="online-game-link" data-game-idx="1" placeholder="Online Link Wasa 1">
          </div>
          <div class="game-post-item hidden" id="game-post-2">
            <h4>Wasa Na 2</h4>
            <input type="url" class="logo-link-team1" data-game-idx="2" placeholder="Logo Link Kungiya 1 (Wasa 2)">
            <input type="text" class="team-name-team1" data-game-idx="2" placeholder="Sunan Kungiya 1 (Wasa 2)">
            <input type="url" class="logo-link-team2" data-game-idx="2" placeholder="Logo Link Kungiya 2 (Wasa 2)">
            <input type="text" class="team-name-team2" data-game-idx="2" placeholder="Sunan Kungiya 2 (Wasa 2)">
            <input type="datetime-local" class="game-time" data-game-idx="2" placeholder="Lokacin Fara Wasa 2">
            <input type="url" class="online-game-link" data-game-idx="2" placeholder="Online Link Wasa 2">
          </div>
          <div class="game-post-item hidden" id="game-post-3">
            <h4>Wasa Na 3</h4>
            <input type="url" class="logo-link-team1" data-game-idx="3" placeholder="Logo Link Kungiya 1 (Wasa 3)">
            <input type="text" class="team-name-team1" data-game-idx="3" placeholder="Sunan Kungiya 1 (Wasa 3)">
            <input type="url" class="logo-link-team2" data-game-idx="3" placeholder="Logo Link Kungiya 2 (Wasa 3)">
            <input type="text" class="team-name-team2" data-game-idx="3" placeholder="Sunan Kungiya 2 (Wasa 3)">
            <input type="datetime-local" class="game-time" data-game-idx="3" placeholder="Lokacin Fara Wasa 3">
            <input type="url" class="online-game-link" data-game-idx="3" placeholder="Online Link Wasa 3">
          </div>
        </div>
        <button id="add-game-post-btn" type="button"><i class="fas fa-plus"></i> Ƙara Wasan</button>
      </div>

      <div id="media-preview"></div>
      
      <textarea id="written-post" rows="5" placeholder="Rubuta labari ko bayanin da kake so..."></textarea>
      <button id="submit-post" type="button"><i class="fas fa-paper-plane"></i> Tura Post</button>
    </div>
  
      
      
          <div class="menu-wrapper">
  <button id="toggle-menu-btn" class="toggle-button">
    Teams Menu
  </button>
  
  <div id="menu-container" class="menu-container">
    <span id="close-menu-btn" class="close-btn">❌</span>
    </div>
</div>

<div id="notification" class="notification"></div>

</div>
</div>
<script>

const clubs = [
    { name: "Real Madrid", logo: "https://upload.wikimedia.org/wikipedia/en/5/56/Real_Madrid_CF.svg", id: "real-madrid" },
    { name: "Manchester United", logo: "https://upload.wikimedia.org/wikipedia/en/7/7a/Manchester_United_FC_crest.svg", id: "man-united" },
    { name: "Barcelona", logo: "https://upload.wikimedia.org/wikipedia/en/4/47/FC_Barcelona_%28crest%29.svg", id: "barcelona" },
    { name: "Chelsea", logo: "https://upload.wikimedia.org/wikipedia/en/c/cc/Chelsea_FC.svg", id: "chelsea" },
    { name: "Liverpool", logo: "https://upload.wikimedia.org/wikipedia/en/0/0c/Liverpool_FC.svg", id: "liverpool" },
    { name: "Arsenal", logo: "https://upload.wikimedia.org/wikipedia/en/5/53/Arsenal_FC.svg", id: "arsenal" },
    { name: "Manchester City", logo: "https://upload.wikimedia.org/wikipedia/en/e/eb/Manchester_City_FC_badge.svg", id: "man-city" },
    { name: "AC Milan", logo: "https://upload.wikimedia.org/wikipedia/commons/d/d0/Logo_of_AC_Milan.svg", id: "ac-milan" },
    { name: "Paris Saint-Germain", logo: "https://upload.wikimedia.org/wikipedia/en/a/a7/Paris_Saint-Germain_F.C..svg", id: "psg" },
    { name: "Tottenham Hotspur", logo: "https://upload.wikimedia.org/wikipedia/en/b/b4/Tottenham_Hotspur.svg", id: "tottenham" },
    { name: "Borussia Dortmund", logo: "https://upload.wikimedia.org/wikipedia/commons/6/67/Borussia_Dortmund_logo.svg", id: "dortmund" },
    { name: "AS Roma", logo: "https://upload.wikimedia.org/wikipedia/en/f/f7/AS_Roma_logo_%282017%29.svg", id: "roma" },
    { name: "Ajax", logo: "https://upload.wikimedia.org/wikipedia/en/7/79/Ajax_Amsterdam.svg", id: "ajax" },
    { name: "Leicester City", logo: "https://upload.wikimedia.org/wikipedia/en/2/2d/Leicester_City_crest.svg", id: "leicester" },
    { name: "Everton", logo: "https://upload.wikimedia.org/wikipedia/en/7/7c/Everton_FC_logo.svg", id: "everton" },
    { name: "Valencia", logo: "https://upload.wikimedia.org/wikipedia/en/c/ce/Valenciacf.svg", id: "valencia" },
    { name: "West Ham United", logo: "https://upload.wikimedia.org/wikipedia/en/c/c2/West_Ham_United_FC_logo.svg", id: "west-ham" },
    { name: "Inter Milan", logo: "https://upload.wikimedia.org/wikipedia/commons/0/05/FC_Internazionale_Milano_2021.svg", id: "inter" },
    { name: "Atletico Madrid", logo: "https://i.imgur.com/B7Lkdmh.png", id: "atletico" }, 
    { name: "Bayern Munich", logo: "https://i.imgur.com/rMkzULt.png", id: "bayern" },
    { name: "Napoli", logo: "https://i.imgur.com/qdZR69v.png", id: "napoli" }, 
    { name: "Juventus", logo: "https://i.imgur.com/M8hB4NN.png", id: "juventus" }, 
    { name: "Sevilla", logo: "https://i.imgur.com/hY4lfmA.png", id: "sevilla" },
    { name: "Benfica", logo: "https://i.imgur.com/iatwLH3.png", id: "benfica" }, 
    { name: "Lyon", logo: "https://i.imgur.com/4iqSKHe.png", id: "lyon" },
      
    { name: "PSV Eindhoven", logo: "https://upload.wikimedia.org/wikipedia/en/0/05/PSV_Eindhoven.svg", id: "psv-eindhoven" },
   
   
];

const toggleButton = document.getElementById('toggle-menu-btn');
const menuContainer = document.getElementById('menu-container');
const closeButton = document.getElementById('close-menu-btn'); 
const notification = document.getElementById('notification');

toggleButton.addEventListener('click', () => {
    menuContainer.classList.toggle('show');
});


closeButton.addEventListener('click', () => {
    menuContainer.classList.remove('show');
});


function showNotification(message) {
    notification.textContent = message;
    notification.classList.add('show');
    setTimeout(() => {
        notification.classList.remove('show');
    }, 3000); 
}


function copyToClipboard(text, successMessage) {
    navigator.clipboard.writeText(text).then(() => {
        showNotification(successMessage);
    }).catch(err => {
        console.error('Failed to copy text: ', err);
        showNotification('Failed to copy. Please try again.');
    });
}

function renderTeams() {
    const teamsHTML = clubs.map(club => `
        <div class="team-item" data-team-id="${club.id}">
            <div class="team-info">
                <img src="${club.logo}" alt="${club.name} logo" class="team-logo">
                <span class="team-name">${club.name}</span>
            </div>
            <div class="copy-buttons">
                <button class="copy-btn copy-name">Copy Name</button>
                <button class="copy-btn copy-logo">Copy Logo Link</button>
            </div>
        </div>
    `).join('');
    menuContainer.innerHTML = `
        <span id="close-menu-btn" class="close-btn">❌</span>
        ${teamsHTML}
    `;
    
    document.getElementById('close-menu-btn').addEventListener('click', () => {
        menuContainer.classList.remove('show');
    });
   
    menuContainer.querySelectorAll('.copy-name').forEach(button => {
        button.addEventListener('click', (e) => {
            const teamItem = e.target.closest('.team-item');
            const teamId = teamItem.dataset.teamId;
            const club = clubs.find(c => c.id === teamId);
            if (club) {
                copyToClipboard(club.name, `Successfully copied: ${club.name}`);
            }
        });
    });

    menuContainer.querySelectorAll('.copy-logo').forEach(button => {
        button.addEventListener('click', (e) => {
            const teamItem = e.target.closest('.team-item');
            const teamId = teamItem.dataset.teamId;
            const club = clubs.find(c => c.id === teamId);
            if (club) {
                copyToClipboard(club.logo, `Successfully copied logo link for: ${club.name}`);
            }
        });
    });
}

 
document.addEventListener('DOMContentLoaded', renderTeams);
</script>
      </section>


 
<script type="module">
    import { app, analytics, firebaseConfig } from './firebase.js';
    import {
        getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import {
        getDatabase, ref, get, set, remove
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";
    const IMGUR_CLIENT_ID = "5acf7eff9c91660";
    const POSTING_ID = "Posting";
    const KAITSAYE_POST_ID = "KaiTsayePost";
    const SOCIAL_MEDIA_WORKER_URL = "https://worker33.workers.dev/socialPost";
    const BASE_VIEWS_LINK = "https://tauraronwasa.pages.dev";
    const MAX_IMAGE_SIZE_MB = 1;

    const preloader = document.getElementById('preloader');
    const loginSection = document.getElementById('login-section');
    const verifySection = document.getElementById('verify-section');
    const mainSection = document.getElementById('main-section');
    const loginForm = document.getElementById('login-form');
    const verifyForm = document.getElementById('verify-form');
    const pushContainer = document.getElementById('push-container');
    const headerFullname = document.getElementById('header-fullname');
    const userFullnameSpan = document.getElementById('user-fullname');
    const logoutBtn = document.getElementById('logout-btn');
    const uploadImgBtn = document.getElementById('upload-img-btn');
    const uploadVideoBtn = document.getElementById('upload-video-btn');
    const imgInput = document.getElementById('img-input');
    const videoInput = document.getElementById('video-input');
    const mediaPreview = document.getElementById('media-preview');
    const writtenPost = document.getElementById('written-post');
    const submitPost = document.getElementById('submit-post');
    const videoLinkInput = document.getElementById('video-link');
    const addImageLink = document.getElementById('add-image-link');
    const imageLinkInput = document.getElementById('image-link');
    const audioLinkInput = document.getElementById('audio-link');
    const radioAudioLinkInput = document.getElementById('radio-audio-link');
    const gamePostsContainer = document.getElementById('game-posts-container');
    const addGamePostBtn = document.getElementById('add-game-post-btn');
    const gamePostItems = document.querySelectorAll('.game-post-item');

    let currentUser = null;
    let userData = null;
    let mediaFiles = [];
    let linkMedia = [];
    let audioLink = "";
    let rediyoKaiTsayeAudioLink = "";
    let gamePosts = [];

    function showPreloader(show = true) {
        preloader.style.display = show ? 'flex' : 'none';
    }
    function pushNotify(msg, type = "info", timeout = 3500) {
        const el = document.createElement("div");
        el.className = "push-notification " + (type || "");
        el.innerHTML = `<i class="fas fa-${type === 'error' ? 'times' : (type === 'success' ? 'check' : 'info')}"></i> ${msg}`;
        pushContainer.appendChild(el);
        setTimeout(() => { el.remove(); }, timeout);
    }

    const auth = getAuth(app);
    const db = getDatabase(app);

    let userIpAddress = "";
    fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => { userIpAddress = data.ip; })
        .catch(() => { userIpAddress = "unknown"; });
    
    let subscriptionObject = null;
    if ('serviceWorker' in navigator && 'PushManager' in window) {
        navigator.serviceWorker.ready.then(registration => {
            return registration.pushManager.getSubscription();
        }).then(subscription => {
            subscriptionObject = subscription;
        }).catch(() => {});
    }

    onAuthStateChanged(auth, async user => {
        if (user) {
            showPreloader(true);
            currentUser = user;
            const userRef = ref(db, `users/${user.uid}`);
            const snap = await get(userRef);
            if (snap.exists()) {
                userData = snap.val();
                userData.uid = user.uid;
                loginSection.classList.add('hidden');
                verifySection.classList.remove('hidden');
                userFullnameSpan.textContent = "";
            } else {
                showPreloader(false);
                pushNotify("Bayanai na mai amfani basu cika ba.", 'error');
                await signOut(auth);
                loginSection.classList.remove('hidden');
                verifySection.classList.add('hidden');
                mainSection.classList.add('hidden');
            }
            showPreloader(false);
        } else {
            showPreloader(false);
            loginSection.classList.remove('hidden');
            verifySection.classList.add('hidden');
            mainSection.classList.add('hidden');
        }
    });

    loginForm.addEventListener('submit', async e => {
        e.preventDefault();
        showPreloader(true);
        const email = loginForm['login-email'].value;
        const password = loginForm['login-password'].value;
        try {
            await signInWithEmailAndPassword(auth, email, password);
        } catch (err) {
            showPreloader(false);
            pushNotify("Shiga ya gaza: " + (err.message || ""), "error");
        }
    });

    verifyForm.addEventListener('submit', async e => {
        e.preventDefault();
        const pwd = verifyForm['verify-password'].value;
        if (pwd !== "6683") {
            pushNotify("Kalmar tabbatarwa ba daidai ba.", "error");
            return;
        }
        verifySection.classList.add('hidden');
        mainSection.classList.remove('hidden');
        headerFullname.textContent = "";
        resetPostForm();
    });

    logoutBtn.addEventListener('click', async () => {
        await signOut(auth);
        location.reload();
    });

    async function uploadMediaSmart(file, type) {
        const MAX_FILE_BYTES = MAX_IMAGE_SIZE_MB * 1024 * 1024;
        if (file.size > MAX_FILE_BYTES) {
            pushNotify(`${type} ya fi girman da ake bukata (${MAX_IMAGE_SIZE_MB}MB)`, "error");
            return null;
        }
        try {
            const formData = new FormData();
            formData.append("image", file);
            const res = await fetch("https://api.imgur.com/3/image", {
                method: "POST",
                headers: {
                    Authorization: "Client-ID " + IMGUR_CLIENT_ID
                },
                body: formData
            });
            const data = await res.json();
            if (data.success && data.data && data.data.link) {
                return data.data.link;
            }
        } catch (e) {}
        try {
            const formData = new FormData();
            formData.append("file", file);
            formData.append("id", Date.now().toString());
            formData.append("type", type);
            const response = await fetch('https://tauraron-wasa-admin.vercel.app/api/getLink', {
                method: 'POST',
                headers: {
                    'x-api-key': '@haruna66'
                },
                body: formData
            });
            const result = await response.json();
            if (response.ok && result.success && result.link) {
                return result.link;
            }
        } catch (err) {}
        return null;
    }

    uploadImgBtn.addEventListener('click', () => imgInput.click());
    imgInput.addEventListener('change', async (e) => {
        const files = Array.from(e.target.files).slice(0, 2 - mediaFiles.filter(f => f.type === 'img').length);
        if (files.length === 0) return;
        for (const file of files) {
            if (!file.type.startsWith("image/")) continue;
            showPreloader(true);
            const url = await uploadMediaSmart(file, "image");
            if (url) {
                mediaFiles.push({ type: "img", url });
                pushNotify("Hoto ya loda daidai!", "success");
            } else {
                pushNotify("Gaza loda hoto.", "error");
            }
            showPreloader(false);
        }
        imgInput.value = "";
        updateMediaPreview();
    });

    uploadVideoBtn.addEventListener('click', () => videoInput.click());
    videoInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        if (!file.type.startsWith("video/")) {
            pushNotify("Za a so bidiyo kawai.", "error");
            return;
        }
        showPreloader(true);
        const url = await uploadMediaSmart(file, "video");
        if (url) {
            mediaFiles = mediaFiles.filter(f => f.type !== "video");
            mediaFiles.push({ type: "video", url });
            pushNotify("Bidiyo ya loda daidai!", "success");
        } else {
            pushNotify("Gaza loda bidiyo.", "error");
        }
        showPreloader(false);
        videoInput.value = "";
        updateMediaPreview();
    });

    addImageLink.addEventListener('click', async e => {
        e.preventDefault();
        const link = imageLinkInput.value.trim();
        if (!link) return;
        showPreloader(true);
        const ok = await testLink(link);
        showPreloader(false);
        if (!ok) return pushNotify("Link na hoto bai yi ba, a sake kokari.", "error");
        if (linkMedia.filter(l => l.type === "img").length + mediaFiles.filter(f => f.type === "img").length >= 2) {
            return pushNotify("Za a iya saka hotuna biyu kawai.", "error");
        }
        linkMedia.push({ type: "img", url: link });
        updateMediaPreview();
        imageLinkInput.value = "";
        pushNotify("Link na hoto yayi daidai.", "success");
    });

    async function testLink(link) {
        try {
            const res = await fetch(link, { method: "HEAD" });
            return res.ok;
        } catch (e) { return false; }
    }

    let visibleGamePosts = 1;
    addGamePostBtn.addEventListener('click', () => {
        if (visibleGamePosts < 3) {
            visibleGamePosts++;
            document.getElementById(`game-post-${visibleGamePosts}`).classList.remove('hidden');
            if (visibleGamePosts === 3) {
                addGamePostBtn.style.display = 'none';
            }
        }
    });

    function collectGameData() {
        const games = [];
        for (let i = 1; i <= visibleGamePosts; i++) {
            const logoLink1 = document.querySelector(`.logo-link-team1[data-game-idx="${i}"]`).value.trim();
            const teamName1 = document.querySelector(`.team-name-team1[data-game-idx="${i}"]`).value.trim();
            const logoLink2 = document.querySelector(`.logo-link-team2[data-game-idx="${i}"]`).value.trim();
            const teamName2 = document.querySelector(`.team-name-team2[data-game-idx="${i}"]`).value.trim();
            const gameTime = document.querySelector(`.game-time[data-game-idx="${i}"]`).value.trim();
            const onlineGameLink = document.querySelector(`.online-game-link[data-game-idx="${i}"]`).value.trim();
            if (logoLink1 || teamName1 || logoLink2 || teamName2 || gameTime || onlineGameLink) {
                games.push({
                    [`onlineLink${i}LogoLink1`]: logoLink1 || null,
                    [`sunanKungiya${(i * 2) - 1}`]: teamName1 || null,
                    [`onlineLink${i}LogoLink2`]: logoLink2 || null,
                    [`sunanKungiya${(i * 2)}`]: teamName2 || null,
                    [`timeDaZaaFaraWasa${(i * 2) - 1}`]: gameTime || null,
                    [`onlineLink${i}`]: onlineGameLink || null
                });
            }
        }
        return games;
    }

    function updateMediaPreview() {
        const allMedia = [...mediaFiles, ...linkMedia];
        mediaPreview.innerHTML = "";
        for (let i = 0; i < allMedia.length; i++) {
            const m = allMedia[i];
            const div = document.createElement("div");
            div.className = "media-item";
            let inner = "";
            if (m.type === "img") {
                inner = `<img src="${m.url}" alt="Hoto">`;
            } else if (m.type === "video") {
                inner = `<video src="${m.url}" controls poster="${m.url}?poster=1"></video>`;
            }
            inner += `<button class="media-remove" data-idx="${i}" title="Goge"><i class="fa fa-times"></i></button>`;
            div.innerHTML = inner;
            mediaPreview.appendChild(div);
        }
        document.querySelectorAll('.media-remove').forEach(btn => {
            btn.onclick = () => {
                const idx = +btn.dataset.idx;
                if (idx < mediaFiles.length) mediaFiles.splice(idx, 1);
                else linkMedia.splice(idx - mediaFiles.length, 1);
                updateMediaPreview();
            };
        });
    }

    function getNigeriaTime() {
        const now = new Date();
        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
        return new Date(utc + 3600000).toISOString();
    }

    async function processOldPostAndMoveToPosting() {
        showPreloader(true);
        const kaiTsayeRef = ref(db, KAITSAYE_POST_ID);
        try {
            const oldSnap = await get(kaiTsayeRef);
            if (oldSnap.exists()) {
                const oldPost = oldSnap.val();
                const hasText = !!oldPost.text;
                const hasPhoto = !!oldPost.photoLink;
                const hasVideo = !!oldPost.videoLink;
                const hasAudio = !!oldPost.audioPostLink;
                let newPostData = null;
                if ((hasText || hasPhoto || hasVideo || hasAudio) && !oldPost.rediyoKaiTsayeAudioLink) {
                    const newPostId = "post-" + Date.now();
                    const photos = [];
                    if (oldPost.photoLink) photos.push(oldPost.photoLink);

                    newPostData = {
                        postid: newPostId,
                        text: oldPost.text || "",
                        photoLink1: photos[0] || null,
                        photoLink2: photos[1] || null,
                        videoLink: oldPost.videoLink || null,
                        audioLink: oldPost.audioPostLink || null,
                        see: oldPost.see || 0,
                        like: oldPost.love || 0,
                        icons: 0,
                        share: oldPost.shere || 0,
                        postingTime: getNigeriaTime(),
                        ...Object.keys(oldPost).filter(k => k.startsWith('onlineLink') || k.startsWith('sunanKungiya') || k.startsWith('timeDaZaaFaraWasa')).reduce((acc, key) => ({ ...acc, [key]: oldPost[key] }), {})
                    };
                }
                
                if (newPostData) {
                    const postingRef = ref(db, `${POSTING_ID}/${newPostData.postid}`);
                    await set(postingRef, newPostData);
                    pushNotify("An motsa tsohon post zuwa Posting cikin nasara!", "success");
                    const socialPostPayload = {
                        postId: newPostData.postid,
                        title: newPostData.text ? newPostData.text.substring(0, 70) + (newPostData.text.length > 70 ? "..." : "") : "Sabon Post",
                        viewsLink: `${BASE_VIEWS_LINK}?postId=${newPostData.postid}`,
                        imageUrl: newPostData.photoLink1 || null,
                        audioUrl: newPostData.audioLink || null,
                        timestamp: getNigeriaTime()
                    };
                    await sendToSocialMediaWorker(socialPostPayload);
                } else {
                    pushNotify("Tsohon post bai cika ka'idojin turawa Posting ba, za'a goge shi daga KaiTsayePost.", "info");
                }
                await remove(kaiTsayeRef);
                pushNotify("An goge tsohon post daga KaiTsayePost.", "success");
            } else {
                pushNotify("Babu tsohon post a KaiTsayePost, zai yi sabon post.", "info");
            }
        } catch (e) {
            pushNotify("Kuskure wajen sarrafa tsohon post: " + (e.message || ""), "error");
        } finally {
            showPreloader(false);
        }
    }

    submitPost.addEventListener('click', async () => {
        const text = writtenPost.value.trim();
        audioLink = audioLinkInput.value.trim();
        rediyoKaiTsayeAudioLink = radioAudioLinkInput.value.trim();
        const videoLinkFromInput = videoLinkInput.value.trim();
        const gamesData = collectGameData();

        linkMedia = linkMedia.filter(l => l.type !== "video");
        if (videoLinkFromInput) {
            linkMedia.push({ type: "video", url: videoLinkFromInput });
        }

        if (!text && !mediaFiles.length && !linkMedia.length && !audioLink && !rediyoKaiTsayeAudioLink && gamesData.length === 0) {
            pushNotify("Dole a rubuta ko loda abu kafin a tura.", "error");
            return;
        }

        const allCurrentMedia = [...mediaFiles, ...linkMedia];
        if (allCurrentMedia.filter(m => m.type === "video").length > 1) {
            pushNotify("Za a iya loda bidiyo guda 1 kawai.", "error");
            return;
        }
        if (allCurrentMedia.filter(m => m.type === "img").length > 2) {
            pushNotify("Za a iya loda hotuna 2 kawai.", "error");
            return;
        }

        showPreloader(true);
        try {
            await processOldPostAndMoveToPosting();
            const newKaiTsayePostId = "post-" + Date.now();
            const imgLinks = allCurrentMedia.filter(m => m.type === "img");
            const videoLinks = allCurrentMedia.filter(m => m.type === "video");
            
            const newPostToKaiTsaye = {
                postid: newKaiTsayePostId,
                rediyoKaiTsayeAudioLink: rediyoKaiTsayeAudioLink || null,
                audiolink: audioLink || null,
                posttime: getNigeriaTime(),
                text: text,
                videoLink: videoLinks.length > 0 ? videoLinks[0].url : null,
                photoLink: imgLinks.length > 0 ? imgLinks[0].url : null,
                audioPostLink: audioLink || null,
                see: 0,
                love: 0,
                shere: 0,
                ...(gamesData.length > 0 && {
                    onlineLink1LogoLink1: gamesData[0]?.[`onlineLink1LogoLink1`] || null,
                    onlineLink1LogoLink2: gamesData[0]?.[`onlineLink1LogoLink2`] || null,
                    sunanKungiya1: gamesData[0]?.[`sunanKungiya1`] || null,
                    sunanKungiya2: gamesData[0]?.[`sunanKungiya2`] || null,
                    timeDaZaaFaraWasa1: gamesData[0]?.[`timeDaZaaFaraWasa1`] || null,
                    onlineLink1: gamesData[0]?.onlineLink1 || null,
                    onlineLink2LogoLink1: gamesData[1]?.[`onlineLink2LogoLink1`] || null,
                    onlineLink2LogoLink2: gamesData[1]?.[`onlineLink2LogoLink2`] || null,
                    sunanKungiya3: gamesData[1]?.[`sunanKungiya3`] || null,
                    sunanKungiya4: gamesData[1]?.[`sunanKungiya4`] || null,
                    timeDaZaaFaraWasa3: gamesData[1]?.[`timeDaZaaFaraWasa3`] || null,
                    onlineLink2: gamesData[1]?.onlineLink2 || null,
                    onlineLink3LogoLink1: gamesData[2]?.[`onlineLink3LogoLink1`] || null,
                    onlineLink3LogoLink2: gamesData[2]?.[`onlineLink3LogoLink2`] || null,
                    sunanKungiya5: gamesData[2]?.[`sunanKungiya5`] || null,
                    sunanKungiya6: gamesData[2]?.[`sunanKungiya6`] || null,
                    timeDaZaaFaraWasa5: gamesData[2]?.[`timeDaZaaFaraWasa5`] || null,
                    onlineLink3: gamesData[2]?.onlineLink3 || null
                })
            };
            await set(ref(db, KAITSAYE_POST_ID), newPostToKaiTsaye);
            pushNotify("An tura sabon post zuwa KaiTsayePost cikin nasara!", "success");
            resetPostForm();
        } catch (e) {
            pushNotify("Gaza tura post: " + (e.message || ""), "error");
        } finally {
            showPreloader(false);
        }
    });

    async function sendToSocialMediaWorker(payload) {
        try {
            const response = await fetch(SOCIAL_MEDIA_WORKER_URL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            if (!response.ok) {
                throw new Error(result.message || `HTTP error! status: ${response.status}`);
            }
            pushNotify(result.message || "An aika post zuwa social media!", "success");
        } catch (error) {
            console.error("Error sending to social media worker:", error);
            pushNotify("✔️Akwai matsala wajen tura post zuwa social media: " + error.message, "error");
        }
    }

    function resetPostForm() {
        writtenPost.value = "";
        mediaFiles = [];
        linkMedia = [];
        audioLink = "";
        rediyoKaiTsayeAudioLink = "";
        audioLinkInput.value = "";
        radioAudioLinkInput.value = "";
        videoLinkInput.value = "";

        updateMediaPreview();
        gamePostItems.forEach((item, index) => {
            item.querySelectorAll('input').forEach(input => input.value = "");
            if (index > 0) {
                item.classList.add('hidden');
            }
        });
        visibleGamePosts = 1;
        addGamePostBtn.style.display = 'block';
    }

    window.addEventListener("DOMContentLoaded", () => showPreloader(false));
</script>
</body>
</html>
